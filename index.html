<!DOCTYPE html>
<!-- saved from url=(0049)file:///C:/workspace/html_start-master/index.html -->
<html lang="ko"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>🦊 My Qutu Wallet</title>

  <!-- 이더리움 네트워크와 상호작용하는 가장 JS 라이브러리 -->
  <script src="js/web3.min.js"></script>
  <!-- 텍스트(주소 등)를 QR 코드로 생성할 때 사용 -->
  <script src="js/qrcode.min.js"></script>
  <script src="js/jquery-latest.js"></script>
  <!-- 트랜잭션 객체를 생성하고 서명하는 데 필요한 라이브러리 -->
  <script type="text/javascript" src="js/ethereumjs-tx-1.3.3.min.js"></script>

  

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      border-radius: 12px;
      background-color: #f8f9fa;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    input[type="text"], input[type="password"] {
      width: 95%;
      padding: 10px;
      margin: 6px 0 16px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    textarea {
      width: 95%;
      height: 120px;
      padding: 10px;
      font-size: 15px;
      border: 1px solid #aaa;
      border-radius: 8px;
      margin-bottom: 20px;
      resize: vertical;
    }

    button {
      padding: 10px 18px;
      margin: 5px 5px 15px 0;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    #qrModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
    }

    #qrContent {
      background: white;
      padding: 20px;
      border-radius: 16px;
      text-align: center;
    }

    body.dark-mode {
      background-color: #1e1e1e;
      color: #f0f0f0;
    }

    body.dark-mode input,
    body.dark-mode textarea {
      background-color: #2c2c2c;
      color: white;
      border-color: #555;
    }

    body.dark-mode button {
      background-color: #3399ff;
    }

    body.dark-mode button:hover {
      background-color: #237acc;
    }

    .dark-mode-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px 14px;
      font-size: 14px;
      background-color: #444;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 999;
    }

    .dark-mode-toggle:hover {
      background-color: #666;
    }

    #addressBook {
      margin-top: 30px;
    }

    #addressBook ul {
      padding-left: 20px;
      list-style: none;
    }

    #addressBook li {
      margin: 5px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #e9ecef;
      padding: 6px 12px;
      border-radius: 8px;
      transition: background-color 0.2s ease;
    }

    #addressBook li:hover {
      background-color: #ced4da;
    }

    #addressBook li span {
      flex-grow: 1;
      flex-shrink: 0;
      min-width: 250px;
      user-select: none;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* 복사 버튼 스타일 */
    #addressBook li button.copy-btn {
      flex-shrink: 0;
      width: 60px;
      margin-left: 10px;
      padding: 4px 8px;
      font-size: 12px;
      background-color: #28a745;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    #addressBook li button.copy-btn:hover {
      background-color: #218838;
    }

    /* 삭제 버튼 스타일 */
    #addressBook li button.delete-btn {
      flex-shrink: 0;
      width: 60px;
      margin-left: 10px;
      padding: 4px 8px;
      font-size: 12px;
      background-color: #dc3545;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }

    #addressBook li button.delete-btn:hover {
      background-color: #c82333;
    }
  </style>
</head>

<body>
  <h2>🦊 My Quantum Wallet</h2>
  <button class="dark-mode-toggle" onclick="toggleDarkMode()">🌙 테마 전환</button>

  <label>송신처:</label><br>
  <input type="text" id="fromAddress" maxlength="60"><br>

  <label>개인키:</label><br>
  <input type="password" id="privateKey" maxlength="66"><br>

  <label>수신처:</label><br>
  <input type="text" id="toAddress" maxlength="60"><br>

  <label>금액 (Qutu):</label><br>
  <input type="text" id="amount" maxlength="20"><br>

  <label>메시지:</label><br>
  <textarea id="message" readonly=""></textarea><br>

  <button onclick="createAccount()">계정 생성</button>
  <button onclick="getBalance()">잔액 조회</button>
  <button onclick="sendTransaction()">Quantum 전송</button>
  <button onclick="generateQRCode()">QR 코드 생성</button>

  <!-- 주소북 추가 입력창 -->
  <h3>📒 주소북 저장</h3>
  <label>닉네임:</label><br>
  <input type="text" id="nickname" maxlength="20"><br>
  <label>주소:</label><br>
  <input type="text" id="addressInput" maxlength="60"><br>
  <button onclick="saveAddressBook()">주소북에 저장</button>

  <!-- 주소북 표시 -->
  <div id="addressBook">
    <h4>📖 저장된 주소들:</h4>
    <ul id="addressList"></ul>
  </div>

  <!-- QR 모달 -->
  <div id="qrModal">
    <div id="qrContent">
      <div id="qrcode"></div>
      <button onclick="closeQR()">닫기</button>
    </div>
  </div>

  <script>
	// web3 인스턴스를 Sepolia 테스트넷 Infura 노드에 연결해 만들기
    const web3 = new Web3("https://sepolia.infura.io/v3/50473e2dece547e8a00e72a271ffa10f");
	const tokenABI = [
	{
		"constant": false,
		"inputs": [
			{
				"name": "_spender",
				"type": "address"
			},
			{
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_spender",
				"type": "address"
			},
			{
				"name": "_value",
				"type": "uint256"
			},
			{
				"name": "_extraData",
				"type": "bytes"
			}
		],
		"name": "approveAndCall",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_to",
				"type": "address"
			},
			{
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_from",
				"type": "address"
			},
			{
				"name": "_to",
				"type": "address"
			},
			{
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"payable": true,
		"stateMutability": "payable",
		"type": "fallback"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "_from",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "_to",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "_owner",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "_spender",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_owner",
				"type": "address"
			},
			{
				"name": "_spender",
				"type": "address"
			}
		],
		"name": "allowance",
		"outputs": [
			{
				"name": "remaining",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_owner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"name": "balance",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "decimals",
		"outputs": [
			{
				"name": "",
				"type": "uint8"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "fundsWallet",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalEthInWei",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "unitsOneEthCanBuy",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "version",
		"outputs": [
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
];                      // ERC-20 표준 ABI (또는 직접 만든 ABI)
  const tokenAddress = "0xA98f25cCCcb54bcF046cb5DF8e0Fb161B04ce04c";     // 당신이 만든 토큰의 주소

  const tokenContract = new web3.eth.Contract(tokenABI, tokenAddress);
	// 계정 생성 함수
    async function createAccount() {
	  // 계정 생성 함수
      const account = web3.eth.accounts.create();
	  // 입력창에 주소화 비밀키 넣기
      document.getElementById("fromAddress").value = account.address;
      document.getElementById("privateKey").value = account.privateKey;
	  // 메세지 창에 주소와 비밀키 출력
      document.getElementById("message").value += `\n✅ 계정 생성됨:\n주소: ${account.address}\n비밀키: ${account.privateKey}\n`;
	  // 팝업창에 문구 출력
      alert("계정이 생성되었습니다: " + account.address);
    }
	
	// 잔액 조회 함수
    async function getBalance() {
	  // 입력창에 사용자가 입력한 주소를 address에 저장
      const address = document.getElementById("fromAddress").value.trim();
	  // 올바른 이더리움 주소인지 검사
      if (!web3.utils.isAddress(address)) {
        document.getElementById("message").value += "❗ 유효한 주소를 입력하세요.\n";
        return;
      }
	  // 주소의 이더리움 잔액 가져오기
      const balance = await tokenContract.methods.balanceOf(address).call();
	  // 결과는 wei 단위(1 ETH = 1,000,000,000,000,000,000 wei)로 나오기 때문에 ETH 단위로 바꿔주기
      const Qutu = web3.utils.fromWei(balance, "ether");
	  // 메세지 창에 현재 잔액 출력
      document.getElementById("message").value += `💰 현재 잔액: ${Qutu} Qutu\n`;
    }
	
	// 이더 전송 함수
    async function sendTransaction() {
      const from = document.getElementById("fromAddress").value.trim();
      const privateKey = document.getElementById("privateKey").value.trim();
      const to = document.getElementById("toAddress").value.trim();
      const amount = document.getElementById("amount").value.trim();

      if (!web3.utils.isAddress(from) || !web3.utils.isAddress(to)) {
        document.getElementById("message").value += "❗ 주소가 유효하지 않습니다.\n";
        return;
      }

      try {
        const decimals = await tokenContract.methods.decimals().call();
        const value = web3.utils.toBN(amount).mul(web3.utils.toBN(10).pow(web3.utils.toBN(decimals)));

        const txCount = await web3.eth.getTransactionCount(from);

        const txObject = {
          nonce: web3.utils.toHex(txCount),
          to: tokenAddress, // ❗ 토큰 컨트랙트 주소로 보내야 함
          data: tokenContract.methods.transfer(to, value).encodeABI(), // 토큰 전송 함수 호출
          gasLimit: web3.utils.toHex(60000), // 일반적으로 50,000~100,000 사이 필요
          gasPrice: web3.utils.toHex(web3.utils.toWei("10", "gwei")),
        };

        const Tx = ethereumjs.Tx;
        const Buffer = ethereumjs.Buffer.Buffer;
        const tx = new Tx(txObject);
        tx.sign(Buffer.from(privateKey.replace(/^0x/, ""), "hex"));
        const serializedTx = tx.serialize();
        const raw = "0x" + serializedTx.toString("hex");

        const txHash = await web3.eth.sendSignedTransaction(raw);
        document.getElementById("message").value += `✅ 전송 성공!\n트랜잭션 해시: ${txHash.transactionHash}\n`;
        } catch (err) {
        document.getElementById("message").value += "❌ 전송 실패: " + err.message + "\n";
        }
    }


    function generateQRCode() {
      const address = document.getElementById("fromAddress").value.trim();
      if (!web3.utils.isAddress(address)) {
        document.getElementById("message").value += "❗ 유효한 이더리움 주소가 아닙니다.\n";
        return;
      }

      const qrDiv = document.getElementById("qrcode");
      qrDiv.innerHTML = "";

      // QRCode 객체 생성 방식
      new QRCode(qrDiv, {
        text: address,
        width: 400,
        height: 400,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });

      document.getElementById("qrModal").style.display = "flex";
      }

	// QR 코드 창 닫기
    function closeQR() {
      document.getElementById("qrModal").style.display = "none";
    }

	// 다크모드
    function toggleDarkMode() {
	  // 다크모드 클래스를 토글(있으면 제거, 없으면 추가)
      document.body.classList.toggle("dark-mode");
      const isDark = document.body.classList.contains("dark-mode");
      localStorage.setItem("theme", isDark ? "dark" : "light");
	  // 모드 상태를 localStorage에 저장
    }

	// 페이지를 처음 로드할 때, 다크모드 설정이 있다면 자동으로 적용
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark-mode");
    }

	// 주소록
    function saveAddressBook() {
	  // 닉네임과 주소 입력 & 공백 제거
      const nickname = document.getElementById("nickname").value.trim();
      const address = document.getElementById("addressInput").value.trim();

	  // 닉네임과 주소 형식이 유효하지 않은 경우 오류 출력 & 종료
      if (!nickname || !web3.utils.isAddress(address)) {
        alert("닉네임과 유효한 주소를 입력하세요.");
        return;
      }

	  // 주소록을 로컬저장소에서 불러와 닉네임:주소를 추가하고 다시 저장
      const book = JSON.parse(localStorage.getItem("addressBook") || "{}");
      book[nickname] = address;
      localStorage.setItem("addressBook", JSON.stringify(book));
	  // 주소록을 다시 그려주고, 입력창 초기화
      renderAddressBook();
      document.getElementById("nickname").value = "";
      document.getElementById("addressInput").value = "";
    }

    // 주소록 표시
    function renderAddressBook() {
	  // 주소록 불러오고, 화면의 리스트 영역을 비움
      const book = JSON.parse(localStorage.getItem("addressBook") || "{}");
      const list = document.getElementById("addressList");
      list.innerHTML = "";

	  // 리스트를 하나씩 그려주기
      for (const name in book) {
	    // li라는 항목을 하나 만듦
        const li = document.createElement("li");

		// 닉네임과 주소를 보여주고, 클릭하면 toAddress 입력창에 주소가 자동으로 입력됨
        const textSpan = document.createElement("span");
        textSpan.textContent = `${name}: ${book[name]}`;
        textSpan.onclick = () => {
          document.getElementById("toAddress").value = book[name];
          document.getElementById("message").value += `📥 [주소북] ${name} 선택됨\n`;
        };

        // 복사 버튼
        const copyBtn = document.createElement("button");
        copyBtn.textContent = "복사";
        copyBtn.className = "copy-btn";
        copyBtn.onclick = (e) => {
          e.stopPropagation();
          navigator.clipboard.writeText(book[name]).then(() => {
            document.getElementById("message").value += `📋 주소 복사됨: ${book[name]}\n`;
            alert(`${book[name]} 가 클립보드에 복사되었습니다.`);
          }).catch(() => {
            alert("복사 실패! 직접 복사해 주세요.");
          });
        };

        // 삭제 버튼
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "삭제";
        deleteBtn.className = "delete-btn";
        deleteBtn.onclick = (e) => {
          e.stopPropagation();
          if (confirm(`${name} 주소를 삭제하시겠습니까?`)) {
            const book = JSON.parse(localStorage.getItem("addressBook") || "{}");
            delete book[name];
            localStorage.setItem("addressBook", JSON.stringify(book));
            renderAddressBook();
            document.getElementById("message").value += `🗑️ [주소북] ${name} 삭제됨\n`;
          }
        };

		// 리스트에 항목 추가
        li.appendChild(textSpan);
        li.appendChild(copyBtn);
        li.appendChild(deleteBtn);
        list.appendChild(li);
      }
    }

    renderAddressBook();
  </script>

  <footer style="text-align: center; margin-top: 40px; font-size: 14px; color: gray;">
    ⓒ Chanjoong, Hyunsoo Since 2025. All Rights Reserved.
  </footer>


</body></html>